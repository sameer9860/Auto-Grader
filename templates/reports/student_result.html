{% extends 'base.html' %}

{% block title %}Result - {{ student.name }} - {{ exam.name }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-6 no-print">
        <div class="flex items-center">
            <a href="{% url 'reports:class_result' student.student_class.id exam.id %}"
                class="text-gray-500 hover:text-gray-700 mr-4">
                <i class="fas fa-arrow-left"></i> Back to Class
            </a>
            <h1 class="text-2xl font-bold text-gray-800">Student Progress Report</h1>
        </div>
        <div>
            <button onclick="window.print()"
                class="bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 shadow transition">
                <i class="fas fa-download mr-2"></i> Download Result
            </button>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200">
        <!-- Result Header -->
        <div class="bg-primary text-white p-8 text-center">
            <h2 class="text-3xl font-bold mb-2">NEPAL AUTO GRADER</h2>
            <p class="text-blue-100 uppercase tracking-widest text-sm">Official Progress Report</p>
        </div>

        <div class="p-8">
            <!-- Student Information -->
            <div class="grid grid-cols-2 gap-8 mb-8 border-b border-gray-100 pb-8">
                <div>
                    <h3 class="text-xs font-bold text-gray-400 uppercase mb-2">Student Information</h3>
                    <p class="text-xl font-bold text-gray-800">{{ student.name }}</p>
                    <p class="text-gray-600">Roll No: {{ student.roll_no }}</p>
                    <p class="text-gray-600">Class: {{ student.student_class.name }} - {{ student.student_class.section
                        }}</p>
                </div>
                <div class="text-right">
                    <h3 class="text-xs font-bold text-gray-400 uppercase mb-2">Examination Details</h3>
                    <p class="text-xl font-bold text-gray-800">{{ exam.name }}</p>
                    <p class="text-gray-600">Date: {{ exam.exam_date|date:"F j, Y" }}</p>
                    <p class="text-gray-600">Batch: {{ student.batch }}</p>
                </div>
            </div>

            <!-- Marks Table -->
            <table class="min-w-full mb-8 border border-gray-200">
                <thead class="bg-gray-50 border-b border-gray-200">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase">Subject</th>
                        <th class="px-4 py-3 text-center text-xs font-bold text-gray-600 uppercase">Full Marks</th>
                        <th class="px-4 py-3 text-center text-xs font-bold text-gray-600 uppercase">Pass Marks</th>
                        <th class="px-4 py-3 text-center text-xs font-bold text-gray-600 uppercase">Obtained</th>
                        <th class="px-4 py-3 text-center text-xs font-bold text-gray-600 uppercase">Grade</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for res in results %}
                    <tr>
                        <td class="px-4 py-4 text-sm font-medium text-gray-800">{{ res.subject.name }}</td>
                        <td class="px-4 py-4 text-sm text-center text-gray-600">{{ res.subject.full_marks }}</td>
                        <td class="px-4 py-4 text-sm text-center text-gray-600">{{ res.subject.pass_marks }}</td>
                        <td class="px-4 py-4 text-sm text-center font-bold text-gray-900">{{ res.marks_obtained }}</td>
                        <td class="px-4 py-4 text-sm text-center font-bold 
                            {% if res.grade == 'NG' %}text-red-600{% else %}text-primary{% endif %}">
                            {{ res.grade }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="bg-gray-50 border-t-2 border-primary font-bold">
                    <tr>
                        <td class="px-4 py-4 text-sm text-gray-800">TOTAL</td>
                        <td class="px-4 py-4 text-sm text-center text-gray-800">{{ total_full_marks }}</td>
                        <td class="px-4 py-4 text-sm text-center">-</td>
                        <td class="px-4 py-4 text-sm text-center text-gray-900 text-lg">{{ total_marks }}</td>
                        <td class="px-4 py-4 text-sm text-center text-primary text-lg">{{ overall_grade.grade }}</td>
                    </tr>
                </tfoot>
            </table>

            <!-- Summary -->
            <div class="bg-blue-50 p-6 rounded-lg flex justify-between items-center text-center">
                <div class="flex-1">
                    <p class="text-xs font-bold text-blue-400 uppercase mb-1">Percentage</p>
                    <p class="text-2xl font-black text-blue-800">{{ overall_percentage|floatformat:2 }}%</p>
                </div>
                <div class="h-12 w-px bg-blue-200"></div>
                <div class="flex-1">
                    <p class="text-xs font-bold text-blue-400 uppercase mb-1">Final Grade</p>
                    <p class="text-2xl font-black text-blue-800">{{ overall_grade.grade }}</p>
                </div>
                <div class="h-12 w-px bg-blue-200"></div>
                <div class="flex-1">
                    <p class="text-xs font-bold text-blue-400 uppercase mb-1">GPA</p>
                    <p class="text-2xl font-black text-blue-800">{{ overall_grade.gpa }}</p>
                </div>
            </div>

            <!-- Footer Remark -->
            <div class="mt-12 pt-8 border-t border-gray-100 flex justify-between items-end">
                <div class="text-xs text-gray-400 italic">
                    This is a computer generated report. Verified by NepalAutoGrader.
                </div>
                <div class="text-center w-40">
                    <div class="border-b border-gray-400 h-10 w-full mb-2"></div>
                    <p class="text-xs font-bold text-gray-500 uppercase">Authorized Principal</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        .no-print {
            display: none !important;
        }

        body {
            background: white;
        }

        .bg-primary {
            background-color: #2563eb !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .text-white {
            color: white !important;
        }

        .shadow,
        .shadow-lg {
            box-shadow: none !important;
        }
    }
</style>
{% endblock %}